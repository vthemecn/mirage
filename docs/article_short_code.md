## åœ¨ WordPress ä¸­ï¼Œâ€œ**æ–‡å­—å†…å®¹ç®€ç ç»„ä»¶**â€é€šå¸¸æ˜¯æŒ‡åˆ©ç”¨ **Shortcodeï¼ˆç®€ç ï¼‰** åŠŸèƒ½æ¥åŠ¨æ€æ’å…¥æˆ–ç”Ÿæˆç‰¹å®šå†…å®¹çš„ä¸€ç§æœºåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥ä»ä¸¤ä¸ªè§’åº¦ç†è§£è¿™ä¸ªè¯´æ³•ï¼š

---

### 1. **ä»€ä¹ˆæ˜¯ Shortcodeï¼ˆç®€ç ï¼‰ï¼Ÿ**

Shortcode æ˜¯ WordPress æä¾›çš„ä¸€ç§ç®€æ˜“æ ‡è®°è¯­æ³•ï¼Œå…è®¸ç”¨æˆ·åœ¨æ–‡ç« ã€é¡µé¢æˆ–å°å·¥å…·ä¸­é€šè¿‡ç±»ä¼¼ `[shortcode]` çš„æ–¹å¼æ’å…¥å¤æ‚åŠŸèƒ½æˆ–åŠ¨æ€å†…å®¹ï¼Œè€Œæ— éœ€ç¼–å†™ PHP æˆ– HTML ä»£ç ã€‚

ä¾‹å¦‚ï¼š
```plaintext
[gallery ids="23,39,45"]
```
è¿™è¡Œç®€ç ä¼šåœ¨å‰å°è‡ªåŠ¨æ¸²æŸ“ä¸ºä¸€ä¸ªå›¾ç‰‡ç”»å»Šã€‚

---

### 2. **â€œæ–‡å­—å†…å®¹ç®€ç ç»„ä»¶â€å…·ä½“æŒ‡ä»€ä¹ˆï¼Ÿ**

è™½ç„¶è¿™ä¸æ˜¯ WordPress å®˜æ–¹æœ¯è¯­ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå®ƒå¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§å«ä¹‰ï¼š

#### âœ… å«ä¹‰ä¸€ï¼šç”¨äºæ’å…¥/æ ¼å¼åŒ–æ–‡å­—å†…å®¹çš„ç®€ç 
æ¯”å¦‚ä½ å®‰è£…äº†ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒæä¾›å¦‚ä¸‹ç®€ç æ¥é«˜äº®æ–‡å­—ã€åˆ›å»ºæç¤ºæ¡†ã€æŠ˜å å†…å®¹ç­‰ï¼š
```plaintext
[highlight]é‡è¦ä¿¡æ¯[/highlight]
[alert type="info"]è¿™æ˜¯ä¸€æ¡é€šçŸ¥[/alert]
[collapse title="ç‚¹å‡»æŸ¥çœ‹"]éšè—çš„å†…å®¹[/collapse]
```
è¿™äº›å°±æ˜¯â€œæ–‡å­—å†…å®¹ç›¸å…³çš„ç®€ç ç»„ä»¶â€â€”â€”å®ƒä»¬ä»¥ç»„ä»¶åŒ–æ–¹å¼å°è£…äº†æ–‡å­—æ’ç‰ˆæˆ–äº¤äº’é€»è¾‘ã€‚

#### âœ… å«ä¹‰äºŒï¼šé¡µé¢æ„å»ºå™¨ä¸­çš„â€œç®€ç ç»„ä»¶â€
å¦‚æœä½ ä½¿ç”¨ Elementorã€WPBakeryã€Divi ç­‰é¡µé¢æ„å»ºå™¨ï¼Œå®ƒä»¬æœ‰æ—¶ä¼šæŠŠæŸäº›æ¨¡å—ç§°ä¸ºâ€œç»„ä»¶â€ï¼Œå…¶ä¸­ä¸€äº›ç»„ä»¶åº•å±‚æ˜¯é€šè¿‡ç®€ç å®ç°çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»å…¸ç¼–è¾‘å™¨ä¸­æ’å…¥ `[contact-form-7 id="123"]`ï¼Œåœ¨å¯è§†åŒ–ç¼–è¾‘å™¨é‡Œå¯èƒ½è¡¨ç°ä¸ºä¸€ä¸ªâ€œè”ç³»è¡¨å•ç»„ä»¶â€ã€‚

#### âœ… å«ä¹‰ä¸‰ï¼šè‡ªå®šä¹‰å¼€å‘çš„ç®€ç åŠŸèƒ½
å¼€å‘è€…å¯ä»¥ä½¿ç”¨ `add_shortcode()` å‡½æ•°æ³¨å†Œè‡ªå·±çš„ç®€ç ï¼Œç”¨æ¥åŠ¨æ€è¾“å‡ºæ–‡å­—å†…å®¹ã€‚ä¾‹å¦‚ï¼š
```php
function my_greeting_shortcode($atts) {
    return "ä½ å¥½ï¼Œæ¬¢è¿è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ï¼";
}
add_shortcode('greeting', 'my_greeting_shortcode');
```
ç„¶ååœ¨æ–‡ç« ä¸­å†™ `[greeting]`ï¼Œå°±ä¼šæ˜¾ç¤ºé‚£æ®µæ¬¢è¿è¯­ã€‚è¿™ç§è‡ªå®šä¹‰åŠŸèƒ½ä¹Ÿå¯è¢«ç§°ä¸ºâ€œæ–‡å­—å†…å®¹ç®€ç ç»„ä»¶â€ã€‚

---

### æ€»ç»“

> â€œWordPress æ–‡å­—å†…å®¹ç®€ç ç»„ä»¶â€ = åˆ©ç”¨ Shortcode æŠ€æœ¯å°è£…çš„ã€ç”¨äºåœ¨å†…å®¹ä¸­æ’å…¥æˆ–æ§åˆ¶æ–‡å­—å±•ç¤ºæ•ˆæœçš„åŠŸèƒ½æ¨¡å—ã€‚

å®ƒè®©éæŠ€æœ¯äººå‘˜ä¹Ÿèƒ½è½»æ¾æ’å…¥åŠ¨æ€å†…å®¹ã€æ ·å¼åŒ–æ–‡æœ¬ã€è°ƒç”¨æ’ä»¶åŠŸèƒ½ç­‰ï¼Œæ˜¯ WordPress å†…å®¹çµæ´»æ€§çš„é‡è¦ä½“ç°ã€‚

---

å¦‚ä½ æœ‰å…·ä½“çš„æ’ä»¶åç§°ã€ç®€ç ç¤ºä¾‹æˆ–ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ æ›´ç²¾å‡†åœ°è§£é‡Šã€‚







## åœ¨ WordPress ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ **è‡ªå®šä¹‰ç®€ç ï¼ˆShortcodeï¼‰** æ¥å®ç°ä»¥ä¸‹ä¸‰ç§å¸¸è§çš„å†…å®¹å¯è§æ€§æ§åˆ¶ï¼š

1. **è¯„è®ºåå¯è§å†…å®¹**  
2. **ç™»å½•ç”¨æˆ·å¯è§å†…å®¹**  
3. **VIPï¼ˆæˆ–ç‰¹å®šç”¨æˆ·è§’è‰²/æƒé™ï¼‰å¯è§å†…å®¹**

ä¸‹é¢æˆ‘å°†åˆ†åˆ«ç»™å‡ºå®ç°æ–¹æ³•ï¼Œå¹¶é™„ä¸Šå¯ç›´æ¥ä½¿ç”¨çš„ä»£ç ã€‚è¿™äº›ä»£ç é€šå¸¸æ”¾åœ¨ä½ ä¸»é¢˜çš„ `functions.php` æ–‡ä»¶ä¸­ï¼ˆå»ºè®®ä½¿ç”¨å­ä¸»é¢˜ï¼‰ï¼Œæˆ–é€šè¿‡æ’ä»¶å¦‚ **Code Snippets** æ·»åŠ ã€‚

---

## âœ… ä¸€ã€è¯„è®ºåå¯è§å†…å®¹ï¼ˆComment-Only Visibleï¼‰

åŸç†ï¼šæ£€æŸ¥å½“å‰æ–‡ç« æ˜¯å¦å·²æœ‰è¯¥ç”¨æˆ·çš„è¯„è®ºï¼ˆé€šè¿‡é‚®ç®±æˆ–ç”¨æˆ· ID åˆ¤æ–­ï¼‰ã€‚

> âš ï¸ æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¾èµ– Cookie æˆ–ç”¨æˆ·ä¿¡æ¯ï¼Œæœ‰ä¸€å®šå±€é™æ€§ï¼Œä½†å¯¹æ™®é€šç«™ç‚¹å¤Ÿç”¨ã€‚

### ä»£ç å®ç°ï¼š

```php
function comment_visible_shortcode($atts, $content = null) {
    if (is_user_logged_in()) {
        // å·²ç™»å½•ç”¨æˆ·ï¼šæ£€æŸ¥æ˜¯å¦æœ‰è¯„è®º
        global $current_user, $post;
        $user_email = $current_user->user_email;
        $comment_count = get_comments([
            'post_id' => $post->ID,
            'author_email' => $user_email,
            'count' => true
        ]);
        if ($comment_count > 0) {
            return do_shortcode($content);
        }
    } else {
        // æœªç™»å½•ç”¨æˆ·ï¼šé€šè¿‡ Cookie æ£€æŸ¥æ˜¯å¦è¯„è®ºè¿‡ï¼ˆéœ€é…åˆè¯„è®ºæ—¶è®¾ç½® Cookieï¼‰
        if (isset($_COOKIE['comment_author_' . COOKIEHASH])) {
            return do_shortcode($content);
        }
    }

    return '<p class="comment-notice">è¯„è®ºæœ¬æ–‡ååˆ·æ–°é¡µé¢å³å¯æŸ¥çœ‹éšè—å†…å®¹ã€‚</p>';
}
add_shortcode('comment_visible', 'comment_visible_shortcode');
```

### ä½¿ç”¨æ–¹å¼ï¼š
åœ¨æ–‡ç« ä¸­å†™ï¼š
```plaintext
[comment_visible]åªæœ‰è¯„è®ºåæ‰èƒ½çœ‹åˆ°è¿™æ®µå†…å®¹ï¼[/comment_visible]
```

> ğŸ’¡ æç¤ºï¼šè‹¥å¸Œæœ›æ›´ä¸¥æ ¼ï¼ˆæ¯”å¦‚å¿…é¡»å®¡æ ¸é€šè¿‡çš„è¯„è®ºï¼‰ï¼Œå¯æ·»åŠ  `'status' => 'approve'` åˆ° `get_comments()` å‚æ•°ä¸­ã€‚

---

## âœ… äºŒã€ç™»å½•ç”¨æˆ·å¯è§å†…å®¹ï¼ˆLogged-in Onlyï¼‰

è¿™ä¸ªæœ€ç®€å•ï¼Œåªéœ€åˆ¤æ–­ `is_user_logged_in()`ã€‚

### ä»£ç å®ç°ï¼š

```php
function logged_in_visible_shortcode($atts, $content = null) {
    if (is_user_logged_in()) {
        return do_shortcode($content);
    } else {
        return '<p class="login-notice">è¯·å…ˆ <a href="' . wp_login_url(get_permalink()) . '">ç™»å½•</a> æŸ¥çœ‹å†…å®¹ã€‚</p>';
    }
}
add_shortcode('logged_in_visible', 'logged_in_visible_shortcode');
```

### ä½¿ç”¨æ–¹å¼ï¼š
```plaintext
[logged_in_visible]ä»…é™ç™»å½•ç”¨æˆ·å¯è§çš„å†…å®¹ã€‚[/logged_in_visible]
```

---

## âœ… ä¸‰ã€VIP ç”¨æˆ·å¯è§å†…å®¹ï¼ˆåŸºäºç”¨æˆ·è§’è‰²æˆ–èƒ½åŠ›ï¼‰

å‡è®¾ä½ çš„ VIP ç”¨æˆ·æ‹¥æœ‰ç‰¹å®šè§’è‰²ï¼ˆå¦‚ `vip`ï¼‰æˆ–å…·å¤‡æŸé¡¹èƒ½åŠ›ï¼ˆcapabilityï¼Œå¦‚ `read_vip_content`ï¼‰ã€‚

### æ–¹æ³• Aï¼šæŒ‰ç”¨æˆ·è§’è‰²åˆ¤æ–­ï¼ˆä¾‹å¦‚è§’è‰²ä¸º `vip`ï¼‰

```php
function vip_visible_shortcode($atts, $content = null) {
    if (!is_user_logged_in()) {
        return '<p class="vip-notice">è¯·å…ˆ <a href="' . wp_login_url(get_permalink()) . '">ç™»å½•</a>ã€‚</p>';
    }

    $user = wp_get_current_user();
    if (in_array('vip', (array) $user->roles)) {
        return do_shortcode($content);
    } else {
        return '<p class="vip-notice">ä»…é™ VIP ä¼šå‘˜æŸ¥çœ‹æ­¤å†…å®¹ã€‚</p>';
    }
}
add_shortcode('vip_visible', 'vip_visible_shortcode');
```

### æ–¹æ³• Bï¼šæŒ‰ç”¨æˆ·èƒ½åŠ›ï¼ˆCapabilityï¼‰åˆ¤æ–­ï¼ˆæ›´æ¨èï¼‰

å…ˆç»™ VIP ç”¨æˆ·æ·»åŠ èƒ½åŠ›ï¼ˆå¯é€šè¿‡æ’ä»¶å¦‚ **User Role Editor**ï¼Œæˆ–ä»£ç ï¼‰ï¼š

```php
// åœ¨ç®¡ç†å‘˜åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ï¼ˆæ…ç”¨ï¼ï¼‰
// add_role('vip', 'VIPä¼šå‘˜', ['read' => true, 'read_vip_content' => true]);
// æˆ–ç»™ç°æœ‰ç”¨æˆ·æ·»åŠ èƒ½åŠ›ï¼š
// $user = new WP_User($user_id);
// $user->add_cap('read_vip_content');
```

ç„¶åç®€ç åˆ¤æ–­èƒ½åŠ›ï¼š

```php
function vip_cap_visible_shortcode($atts, $content = null) {
    if (!is_user_logged_in()) {
        return '<p class="vip-notice">è¯·å…ˆ <a href="' . wp_login_url(get_permalink()) . '">ç™»å½•</a>ã€‚</p>';
    }

    if (current_user_can('read_vip_content')) {
        return do_shortcode($content);
    } else {
        return '<p class="vip-notice">æ‚¨æ²¡æœ‰æƒé™æŸ¥çœ‹ VIP å†…å®¹ã€‚</p>';
    }
}
add_shortcode('vip_content', 'vip_cap_visible_shortcode');
```

### ä½¿ç”¨æ–¹å¼ï¼š
```plaintext
[vip_content]è¿™é‡Œæ˜¯ VIP ä¸“äº«å†…å®¹ï¼[/vip_content]
```

---

## ğŸ”’ å®‰å…¨æç¤º

- ç®€ç åªæ§åˆ¶å‰ç«¯æ˜¾ç¤ºï¼Œ**ä¸ç­‰äºå†…å®¹å®‰å…¨**ã€‚æ•æ„Ÿå†…å®¹åº”é…åˆåç«¯æƒé™æ ¡éªŒã€‚
- é¿å…åœ¨ REST API æˆ– RSS ä¸­æ³„éœ²éšè—å†…å®¹ï¼ˆå¯é€šè¿‡ `is_feed()`ã€`wp_doing_ajax()` ç­‰æ’é™¤ï¼‰ã€‚
- å¯¹äºé«˜ä»·å€¼å†…å®¹ï¼Œå»ºè®®ç»“åˆä¼šå‘˜æ’ä»¶ï¼ˆå¦‚ **MemberPress**, **Restrict Content Pro**ï¼‰å®ç°æ›´å®Œå–„çš„æƒé™ç³»ç»Ÿã€‚

---

## âœ… æ€»ç»“ï¼šä¸‰ä¸ªç®€ç é€ŸæŸ¥

| åŠŸèƒ½ | ç®€ç  | è¯´æ˜ |
|------|------|------|
| è¯„è®ºå¯è§ | `[comment_visible]...[/comment_visible]` | è¯„è®ºè¿‡ï¼ˆå«æœªç™»å½•ç•™è¿‡è¨€ï¼‰å³å¯è§ |
| ç™»å½•å¯è§ | `[logged_in_visible]...[/logged_in_visible]` | å¿…é¡»ç™»å½• |
| VIP å¯è§ | `[vip_content]...[/vip_content]` | éœ€å…·å¤‡ `read_vip_content` èƒ½åŠ› |

---

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ **Classic Editor**ã€**Gutenberg** æˆ– **é¡µé¢æ„å»ºå™¨**ï¼Œè¿™äº›ç®€ç éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚

éœ€è¦æˆ‘å¸®ä½ é›†æˆåˆ°æŸä¸ªå…·ä½“ä¸»é¢˜æˆ–æ’ä»¶ä¸­ï¼Ÿæ¬¢è¿æä¾›æ›´å¤šä¿¡æ¯ï¼